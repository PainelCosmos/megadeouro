<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RM Unity - Painel de Controle</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        .admin-panel {
            transition: all 0.3s ease;
            transform: translateX(100%);
        }
        .admin-panel.active {
            transform: translateX(0);
        }
        .ip-tag {
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(99, 102, 241, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(99, 102, 241, 0); }
            100% { box-shadow: 0 0 0 0 rgba(99, 102, 241, 0); }
        }
    </style>
</head>
<body class="bg-gray-900 text-gray-100 min-h-screen">
    <!-- Admin Login Modal -->
    <div id="adminLoginModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 hidden">
        <div class="bg-gray-800 rounded-lg p-6 w-full max-w-md">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-bold">Acesso Administrativo</h3>
                <button onclick="closeAdminLogin()" class="text-gray-400 hover:text-white">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="mb-4">
                <label class="block text-gray-300 mb-2">Senha</label>
                <input type="password" id="adminPassword" class="w-full bg-gray-700 rounded px-4 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500">
            </div>
            <button onclick="verifyAdmin()" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white py-2 rounded font-medium transition duration-200">
                Acessar Painel Admin
            </button>
        </div>
    </div>

    <!-- Main Container -->
    <div class="container mx-auto px-4 py-8">
        <!-- Header -->
        <header class="flex justify-between items-center mb-8">
            <div class="flex items-center">
                <i class="fas fa-users text-indigo-500 text-3xl mr-3"></i>
                <h1 class="text-2xl font-bold bg-gradient-to-r from-indigo-500 to-purple-600 bg-clip-text text-transparent">
                    RM Unity
                </h1>
            </div>
            <button onclick="openAdminLogin()" class="bg-gray-800 hover:bg-gray-700 px-4 py-2 rounded-lg flex items-center">
                <i class="fas fa-lock mr-2"></i>
                <span>Admin</span>
            </button>
        </header>

        <!-- Main Content -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
            <!-- Group Link Section -->
            <div class="bg-gray-800 rounded-xl p-6 lg:col-span-2">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-xl font-semibold">Entre no Nosso Grupo</h2>
                    <div id="adminEdit" class="hidden">
                        <button onclick="enableEdit()" class="text-indigo-400 hover:text-indigo-300">
                            <i class="fas fa-edit mr-1"></i> Editar Link
                        </button>
                    </div>
                </div>
                
                <div class="bg-gray-700 rounded-lg p-4 mb-4">
                    <div id="linkDisplay" class="flex items-center justify-center">
                        <button onclick="enterGroup()" class="bg-green-600 hover:bg-green-700 px-6 py-3 rounded-lg text-white font-medium text-lg flex items-center">
                            <i class="fab fa-discord text-white text-xl mr-3"></i>
                            Entrar no Grupo
                        </button>
                    </div>
                    
                    <div id="linkEdit" class="hidden mt-4">
                        <div class="flex flex-col space-y-3">
                            <label class="text-gray-300">Link do Grupo:</label>
                            <div class="flex">
                                <input type="text" id="newDiscordLink" class="flex-grow bg-gray-600 rounded-l px-4 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="https://discord.gg/...">
                                <button onclick="saveLink()" class="bg-green-600 hover:bg-green-700 px-4 py-2 rounded-r">
                                    Salvar
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="bg-gray-700 rounded-lg p-4">
                    <h3 class="font-medium mb-2">Estatísticas do Grupo</h3>
                    <div class="grid grid-cols-2 gap-4">
                        <div class="bg-gray-800 rounded-lg p-3">
                            <div class="text-indigo-400 mb-1">
                                <i class="fas fa-users mr-2"></i>
                                <span>Membros</span>
                            </div>
                            <div id="totalMembers" class="text-2xl font-bold">Carregando...</div>
                        </div>
                        <div class="bg-gray-800 rounded-lg p-3">
                            <div class="text-green-400 mb-1">
                                <i class="fas fa-sign-in-alt mr-2"></i>
                                <span>Hoje</span>
                            </div>
                            <div id="todayMembers" class="text-2xl font-bold">Carregando...</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Join Instructions -->
            <div class="bg-gray-800 rounded-xl p-6">
                <h2 class="text-xl font-semibold mb-4">Como Participar</h2>
                <div class="space-y-4">
                    <div class="flex items-start">
                        <div class="bg-indigo-600 rounded-full w-6 h-6 flex items-center justify-center text-sm font-bold mr-3 mt-1 flex-shrink-0">1</div>
                        <p>Clique no botão "Entrar no Grupo"</p>
                    </div>
                    <div class="flex items-start">
                        <div class="bg-indigo-600 rounded-full w-6 h-6 flex items-center justify-center text-sm font-bold mr-3 mt-1 flex-shrink-0">2</div>
                        <p>Você será redirecionado para o Discord</p>
                    </div>
                    <div class="flex items-start">
                        <div class="bg-indigo-600 rounded-full w-6 h-6 flex items-center justify-center text-sm font-bold mr-3 mt-1 flex-shrink-0">3</div>
                        <p>Aceite o convite e siga as regras da comunidade</p>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Recent Members (Visible to Admin) -->
        <div id="recentMembers" class="mt-8 bg-gray-800 rounded-xl p-6 hidden">
            <h2 class="text-xl font-semibold mb-4">Membros Recentes</h2>
            <div class="overflow-x-auto">
                <table class="w-full">
                    <thead>
                        <tr class="text-left border-b border-gray-700">
                            <th class="pb-2">Usuário</th>
                            <th class="pb-2">Data de Entrada</th>
                            <th class="pb-2">Endereço IP</th>
                            <th class="pb-2">Localização</th>
                            <th class="pb-2">ISP</th>
                            <th class="pb-2">Ações</th>
                        </tr>
                    </thead>
                    <tbody id="membersTableBody">
                        <!-- Preenchido por JavaScript -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    
    <!-- Admin Panel (Hidden by default) -->
    <div id="adminPanel" class="admin-panel fixed top-0 right-0 h-full w-full sm:w-96 bg-gray-800 shadow-2xl z-40 overflow-y-auto">
        <div class="p-6">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-xl font-bold text-indigo-400">
                    <i class="fas fa-user-shield mr-2"></i>
                    Painel Admin
                </h2>
                <button onclick="toggleAdminPanel()" class="text-gray-400 hover:text-white">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="mb-6">
                <h3 class="font-medium mb-2 flex items-center">
                    <i class="fas fa-network-wired mr-2"></i>
                    Rastreamento de IP
                </h3>
                <div class="bg-gray-700 rounded-lg p-4">
                    <div class="mb-3">
                        <label class="block text-gray-300 mb-1">Status</label>
                        <div class="flex items-center">
                            <div class="w-3 h-3 rounded-full bg-green-500 mr-2"></div>
                            <span>Ativo</span>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label class="block text-gray-300 mb-1">Capturas Hoje</label>
                        <div id="todayCaptures" class="text-xl font-mono">0</div>
                    </div>
                    <div>
                        <label class="block text-gray-300 mb-1">Total de Capturas</label>
                        <div id="totalCaptures" class="text-xl font-mono">0</div>
                    </div>
                </div>
            </div>
            
            <div class="mb-6">
                <h3 class="font-medium mb-2 flex items-center">
                    <i class="fas fa-search mr-2"></i>
                    Busca por IP
                </h3>
                <div class="bg-gray-700 rounded-lg p-4">
                    <div class="mb-3">
                        <label class="block text-gray-300 mb-1">Buscar por Usuário</label>
                        <input type="text" id="usernameSearch" class="w-full bg-gray-600 rounded px-4 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="Digite o nome de usuário">
                    </div>
                    <div class="mb-3">
                        <label class="block text-gray-300 mb-1">Buscar por IP</label>
                        <input type="text" id="ipSearch" class="w-full bg-gray-600 rounded px-4 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="Digite o endereço IP">
                    </div>
                    <button onclick="searchIP()" class="w-full bg-indigo-600 hover:bg-indigo-700 py-2 rounded font-medium">
                        Buscar
                    </button>
                </div>
            </div>
            
            <div>
                <h3 class="font-medium mb-2 flex items-center">
                    <i class="fas fa-cog mr-2"></i>
                    Configurações
                </h3>
                <div class="bg-gray-700 rounded-lg p-4">
                    <div class="mb-3">
                        <label class="flex items-center">
                            <input type="checkbox" id="enableTracking" class="form-checkbox h-5 w-5 text-indigo-600" checked>
                            <span class="ml-2">Ativar Rastreamento de IP</span>
                        </label>
                    </div>
                    <div class="mb-3">
                        <label class="flex items-center">
                            <input type="checkbox" id="notifyNewJoin" class="form-checkbox h-5 w-5 text-indigo-600">
                            <span class="ml-2">Notificar em Novas Entradas</span>
                        </label>
                    </div>
                    <div>
                        <label class="flex items-center">
                            <input type="checkbox" id="storeIPHistory" class="form-checkbox h-5 w-5 text-indigo-600" checked>
                            <span class="ml-2">Armazenar Histórico de IP</span>
                        </label>
                    </div>
                </div>
            </div>
            
            <div class="mt-6">
                <button onclick="exportIPData()" class="w-full bg-gray-700 hover:bg-gray-600 py-2 rounded font-medium mb-3">
                    <i class="fas fa-file-export mr-2"></i>
                    Exportar Dados de IP
                </button>
                <button onclick="logoutAdmin()" class="w-full bg-red-600 hover:bg-red-700 py-2 rounded font-medium">
                    <i class="fas fa-sign-out-alt mr-2"></i>
                    Sair
                </button>
            </div>
        </div>
    </div>
    
    <script>
        // Admin state
        let isAdmin = false;
        const adminPassword = "Jhzinho123$"; // Senha do admin
        
        // Armazenamento local para membros e estatísticas
        let members = JSON.parse(localStorage.getItem('rmUnityMembers')) || [];
        let stats = JSON.parse(localStorage.getItem('rmUnityStats')) || { 
            totalMembers: 0, 
            todayMembers: 0,
            totalCaptures: 0,
            todayCaptures: 0
        };
        
        // DOM Elements
        const adminLoginModal = document.getElementById('adminLoginModal');
        const adminPanel = document.getElementById('adminPanel');
        const adminEdit = document.getElementById('adminEdit');
        const linkDisplay = document.getElementById('linkDisplay');
        const linkEdit = document.getElementById('linkEdit');
        const recentMembers = document.getElementById('recentMembers');
        const membersTableBody = document.getElementById('membersTableBody');
        const totalMembersElement = document.getElementById('totalMembers');
        const todayMembersElement = document.getElementById('todayMembers');
        const totalCapturesElement = document.getElementById('totalCaptures');
        const todayCapturesElement = document.getElementById('todayCaptures');
        
        // Inicialização
        async function init() {
            // Verificar se há sessão admin no localStorage
            if (localStorage.getItem('adminLoggedIn') === 'true') {
                adminLogin();
            }
            
            // Atualizar estatísticas
            updateStats();
            
            // Carregar membros do servidor (simulado)
            await loadServerMembers();
            
            // Preencher tabela de membros
            renderMembersTable();
            
            // Capturar IP do visitante
            await captureVisitorIP();
        }
        
        // Funções de admin
        function openAdminLogin() {
            adminLoginModal.classList.remove('hidden');
        }
        
        function closeAdminLogin() {
            adminLoginModal.classList.add('hidden');
        }
        
        function verifyAdmin() {
            const passwordInput = document.getElementById('adminPassword');
            if (passwordInput.value === adminPassword) {
                adminLogin();
                closeAdminLogin();
            } else {
                alert('Senha incorreta!');
                passwordInput.value = '';
            }
        }
        
        function adminLogin() {
            isAdmin = true;
            localStorage.setItem('adminLoggedIn', 'true');
            adminEdit.classList.remove('hidden');
            recentMembers.classList.remove('hidden');
        }
        
        function logoutAdmin() {
            isAdmin = false;
            localStorage.removeItem('adminLoggedIn');
            adminEdit.classList.add('hidden');
            recentMembers.classList.add('hidden');
            toggleAdminPanel();
        }
        
        function toggleAdminPanel() {
            adminPanel.classList.toggle('active');
        }
        
        // Gerenciamento de link
        function enableEdit() {
            linkDisplay.classList.add('hidden');
            linkEdit.classList.remove('hidden');
            document.getElementById('newDiscordLink').value = getCurrentGroupLink();
        }
        
        function getCurrentGroupLink() {
            return localStorage.getItem('discordGroupLink') || "https://discord.gg/JRWnCyCux6";
        }
        
        function saveLink() {
            const newLink = document.getElementById('newDiscordLink').value;
            if (newLink && newLink.includes('discord.gg/')) {
                // Salvar no localStorage
                localStorage.setItem('discordGroupLink', newLink);
                linkDisplay.classList.remove('hidden');
                linkEdit.classList.add('hidden');
                alert('Link atualizado com sucesso!');
            } else {
                alert('Por favor, insira um link de convite do Discord válido (deve incluir discord.gg/)');
            }
        }
        
        function enterGroup() {
            const link = getCurrentGroupLink();
            window.open(link, '_blank');
            
            // Registrar evento de entrada
            trackEvent('Entrou no Grupo');
        }
        
        // Tabela de membros
        function renderMembersTable() {
            membersTableBody.innerHTML = '';
            
            // Ordenar membros por data (mais recentes primeiro)
            const sortedMembers = [...members].sort((a, b) => 
                new Date(b.joinDate) - new Date(a.joinDate)
            );
            
            sortedMembers.forEach(member => {
                const row = document.createElement('tr');
                row.className = 'border-b border-gray-700 hover:bg-gray-700';
                row.innerHTML = `
                    <td class="py-3">${member.username}</td>
                    <td class="py-3">${formatDate(member.joinDate)}</td>
                    <td class="py-3 font-mono">
                        <span class="bg-indigo-900 bg-opacity-30 px-2 py-1 rounded text-sm ip-tag">${member.ip}</span>
                    </td>
                    <td class="py-3">${member.location || 'Desconhecido'}</td>
                    <td class="py-3">${member.isp || 'Desconhecido'}</td>
                    <td class="py-3">
                        <button onclick="viewMemberDetails('${member.username}')" class="text-indigo-400 hover:text-indigo-300 mr-2">
                            <i class="fas fa-eye"></i>
                        </button>
                        <button onclick="banMember('${member.username}')" class="text-red-400 hover:text-red-300">
                            <i class="fas fa-ban"></i>
                        </button>
                    </td>
                `;
                membersTableBody.appendChild(row);
            });
        }
        
        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('pt-BR') + ' ' + date.toLocaleTimeString('pt-BR');
        }
        
        function viewMemberDetails(username) {
            const member = members.find(m => m.username === username);
            if (member) {
                alert(`Detalhes do Membro:\n\nUsuário: ${member.username}\nData de Entrada: ${formatDate(member.joinDate)}\nIP: ${member.ip}\nLocalização: ${member.location || 'Desconhecido'}\nISP: ${member.isp || 'Desconhecido'}\nDispositivo: ${member.device || 'Desconhecido'}`);
            }
        }
        
        function banMember(username) {
            if (confirm(`Tem certeza que deseja banir ${username}?`)) {
                // Em uma aplicação real, você enviaria isso para seu backend
                alert(`${username} foi banido com sucesso.`);
            }
        }
        
        function searchIP() {
            const usernameQuery = document.getElementById('usernameSearch').value.toLowerCase();
            const ipQuery = document.getElementById('ipSearch').value;
            
            let results = members;
            
            if (usernameQuery) {
                results = results.filter(m => m.username.toLowerCase().includes(usernameQuery));
            }
            
            if (ipQuery) {
                results = results.filter(m => m.ip.includes(ipQuery));
            }
            
            if (results.length === 0) {
                alert('Nenhum membro encontrado com os critérios de busca.');
            } else {
                // Atualizar tabela com resultados da busca
                membersTableBody.innerHTML = '';
                results.forEach(member => {
                    const row = document.createElement('tr');
                    row.className = 'border-b border-gray-700 hover:bg-gray-700';
                    row.innerHTML = `
                        <td class="py-3">${member.username}</td>
                        <td class="py-3">${formatDate(member.joinDate)}</td>
                        <td class="py-3 font-mono">
                            <span class="bg-indigo-900 bg-opacity-30 px-2 py-1 rounded text-sm ip-tag">${member.ip}</span>
                        </td>
                        <td class="py-3">${member.location || 'Desconhecido'}</td>
                        <td class="py-3">${member.isp || 'Desconhecido'}</td>
                        <td class="py-3">
                            <button onclick="viewMemberDetails('${member.username}')" class="text-indigo-400 hover:text-indigo-300 mr-2">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button onclick="banMember('${member.username}')" class="text-red-400 hover:text-red-300">
                                <i class="fas fa-ban"></i>
                            </button>
                        </td>
                    `;
                    membersTableBody.appendChild(row);
                });
            }
        }
        
        function exportIPData() {
            // Criar CSV com dados de IP
            let csvContent = "data:text/csv;charset=utf-8,";
            csvContent += "Usuário,Data de Entrada,IP,Localização,ISP,Dispositivo\n";
            
            members.forEach(member => {
                csvContent += `"${member.username}","${formatDate(member.joinDate)}","${member.ip}","${member.location || ''}","${member.isp || ''}","${member.device || ''}"\n`;
            });
            
            // Criar link de download
            const encodedUri = encodeURI(csvContent);
            const link = document.createElement("a");
            link.setAttribute("href", encodedUri);
            link.setAttribute("download", "dados_ip_rm_unity.csv");
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }
        
        // Atualizar estatísticas
        function updateStats() {
            totalMembersElement.textContent = stats.totalMembers;
            todayMembersElement.textContent = stats.todayMembers;
            totalCapturesElement.textContent = stats.totalCaptures;
            todayCapturesElement.textContent = stats.todayCaptures;
        }
        
        // Carregar membros do servidor (simulado)
        async function loadServerMembers() {
            try {
                // Simular uma requisição a uma API
                const today = new Date();
                const todayStr = today.toISOString().split('T')[0];
                
                // Se não houver membros no localStorage, criar alguns de exemplo
                if (members.length === 0) {
                    members = [
                        {
                            username: "Jhzinho#1234",
                            joinDate: todayStr + "T12:30:00",
                            ip: "189.45.210.105",
                            location: "São Paulo, Brasil",
                            isp: "Vivo",
                            device: "Windows 10"
                        },
                        {
                            username: "Moderador1#5678",
                            joinDate: todayStr + "T10:15:00",
                            ip: "201.28.135.67",
                            location: "Rio de Janeiro, Brasil",
                            isp: "Claro",
                            device: "Android"
                        },
                        {
                            username: "NovoMembro#9012",
                            joinDate: todayStr + "T09:05:00",
                            ip: "177.220.18.93",
                            location: "Minas Gerais, Brasil",
                            isp: "Oi",
                            device: "iPhone"
                        }
                    ];
                    
                    stats.totalMembers = 125;
                    stats.todayMembers = 3;
                    stats.totalCaptures = 342;
                    stats.todayCaptures = 3;
                    
                    saveDataToLocalStorage();
                }
                
                updateStats();
                
            } catch (error) {
                console.error("Erro ao carregar membros:", error);
            }
        }
        
        // Capturar IP do visitante com múltiplos serviços de fallback
        async function captureVisitorIP() {
            try {
                // Tentar vários serviços de IP até conseguir uma resposta
                const ipServices = [
                    'https://api.ipify.org?format=json',
                    'https://ipapi.co/json/',
                    'https://ipinfo.io/json',
                    'https://api.myip.com',
                    'https://ipwho.is/',
                    'https://www.cloudflare.com/cdn-cgi/trace'
                ];
                
                let ipData = null;
                
                for (const service of ipServices) {
                    try {
                        if (service.includes('cloudflare')) {
                            // Formato especial para Cloudflare
                            const response = await fetch(service);
                            const text = await response.text();
                            const lines = text.split('\n');
                            const ipLine = lines.find(line => line.startsWith('ip='));
                            if (ipLine) {
                                ipData = { ip: ipLine.split('=')[1] };
                                break;
                            }
                        } else {
                            const response = await fetch(service);
                            if (response.ok) {
                                ipData = await response.json();
                                break;
                            }
                        }
                    } catch (e) {
                        console.log(`Falha ao acessar ${service}`);
                    }
                }
                
                if (!ipData) {
                    throw new Error("Todos os serviços de IP falharam");
                }
                
                // Padronizar os dados de IP
                let ip = ipData.ip || ipData.query;
                let location = 'Desconhecido';
                let isp = 'Desconhecido';
                
                // Se usamos ipwho.is ou ipapi.co, temos mais dados
                if (ipData.country) {
                    location = `${ipData.city || ''}${ipData.city ? ', ' : ''}${ipData.region || ''}${ipData.region ? ', ' : ''}${ipData.country}`;
                    isp = ipData.org || ipData.isp || ipData.asn || 'Desconhecido';
                } else if (ipData.ip && !ipData.country) {
                    // Se temos apenas o IP, tentar obter mais informações
                    try {
                        const detailsResponse = await fetch(`https://ipapi.co/${ip}/json/`);
                        if (detailsResponse.ok) {
                            const details = await detailsResponse.json();
                            location = `${details.city || ''}${details.city ? ', ' : ''}${details.region || ''}${details.region ? ', ' : ''}${details.country_name || 'Desconhecido'}`;
                            isp = details.org || 'Desconhecido';
                        }
                    } catch (e) {
                        console.log("Não foi possível obter detalhes do IP");
                    }
                }
                
                // Verificar se já capturamos este IP hoje
                const today = new Date().toISOString().split('T')[0];
                const existingCapture = members.find(m => 
                    m.ip === ip && m.joinDate.includes(today)
                );
                
                if (!existingCapture) {
                    // Adicionar novo membro (visitante)
                    const newMember = {
                        username: "Visitante#" + Math.floor(Math.random() * 10000),
                        joinDate: new Date().toISOString(),
                        ip: ip,
                        location: location,
                        isp: isp,
                        device: getDeviceInfo()
                    };
                    
                    members.push(newMember);
                    stats.totalMembers += 1;
                    stats.todayMembers += 1;
                    stats.totalCaptures += 1;
                    stats.todayCaptures += 1;
                    
                    saveDataToLocalStorage();
                    updateStats();
                    
                    if (isAdmin) {
                        renderMembersTable();
                    }
                }
                
            } catch (error) {
                console.error("Erro ao capturar IP:", error);
                
                // Fallback para WebRTC (pode não funcionar em todos os navegadores)
                try {
                    const rtcPeerConnection = window.RTCPeerConnection || window.mozRTCPeerConnection || window.webkitRTCPeerConnection;
                    if (rtcPeerConnection) {
                        const pc = new rtcPeerConnection({iceServers: []});
                        pc.createDataChannel('');
                        pc.createOffer().then(offer => pc.setLocalDescription(offer));
                        
                        pc.onicecandidate = ice => {
                            if (ice.candidate) {
                                const ipRegex = /([0-9]{1,3}(\.[0-9]{1,3}){3})/;
                                const ipMatch = ipRegex.exec(ice.candidate.candidate);
                                if (ipMatch) {
                                    const fallbackIP = ipMatch[1];
                                    const today = new Date().toISOString().split('T')[0];
                                    const existingCapture = members.find(m => 
                                        m.ip === fallbackIP && m.joinDate.includes(today)
                                    );
                                    
                                    if (!existingCapture) {
                                        const newMember = {
                                            username: "VisitanteWebRTC#" + Math.floor(Math.random() * 10000),
                                            joinDate: new Date().toISOString(),
                                            ip: fallbackIP,
                                            location: "Local (WebRTC)",
                                            isp: "Rede Local",
                                            device: getDeviceInfo()
                                        };
                                        
                                        members.push(newMember);
                                        stats.totalCaptures += 1;
                                        stats.todayCaptures += 1;
                                        saveDataToLocalStorage();
                                        updateStats();
                                    }
                                }
                            }
                        };
                    }
                } catch (rtcError) {
                    console.error("Falha no fallback WebRTC:", rtcError);
                }
            }
        }
        
        // Obter informações do dispositivo
        function getDeviceInfo() {
            const userAgent = navigator.userAgent;
            let device = "Desconhecido";
            
            if (userAgent.match(/Android/i)) {
                device = "Android";
            } else if (userAgent.match(/iPhone|iPad|iPod/i)) {
                device = "iOS";
            } else if (userAgent.match(/Windows/i)) {
                device = "Windows";
            } else if (userAgent.match(/Macintosh/i)) {
                device = "Mac";
            } else if (userAgent.match(/Linux/i)) {
                device = "Linux";
            }
            
            return device;
        }
        
        // Salvar dados no localStorage
        function saveDataToLocalStorage() {
            localStorage.setItem('rmUnityMembers', JSON.stringify(members));
            localStorage.setItem('rmUnityStats', JSON.stringify(stats));
        }
        
        // Registrar eventos
        function trackEvent(eventName) {
            console.log(`Evento registrado: ${eventName}`);
            // Em uma aplicação real, você enviaria isso para seu analytics/backend
        }
        
        // Inicializar o aplicativo
        document.addEventListener('DOMContentLoaded', init);
    </script>
<p style="border-radius: 8px; text-align: center; font-size: 12px; color: #fff; margin-top: 16px;position: fixed; left: 8px; bottom: 8px; z-index: 10; background: rgba(0, 0, 0, 0.8); padding: 4px 8px;">Made with <img src="https://enzostvs-deepsite.hf.space/logo.svg" alt="DeepSite Logo" style="width: 16px; height: 16px; vertical-align: middle;display:inline-block;margin-right:3px;filter:brightness(0) invert(1);"><a href="https://enzostvs-deepsite.hf.space" style="color: #fff;text-decoration: underline;" target="_blank" >DeepSite</a> - 🧬 <a href="https://enzostvs-deepsite.hf.space?remix=Marleytrampos/discord" style="color: #fff;text-decoration: underline;" target="_blank" >Remix</a></p></body>
</html>